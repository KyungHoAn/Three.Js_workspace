<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <link rel="stylesheet" href="./vaz.css">
    <title>Three.js - Fundamentals with light</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.3/gsap.min.js"></script>
  </head>
<body>
    <script type="importmap">
        {
            "imports" : {
                "three" : "../build/three.module.js",
                "OrbitControls" : "./jsm/controls/OrbitControls.js",
                "three/examples/jsm/libs/stats.module": "../examples/jsm/libs/stats.module.js",
                "OBJLoader" :"./jsm/loaders/OBJLoader.js",
                "GLTFLoader":"./jsm/loaders/GLTFLoader.js",
                "GUI":"./jsm/libs/lil-gui.module.min.js",
                "MTLLoader":"./jsm/loaders/MTLLoader.js",
                "VertexNormalsHelper":"./jsm/helpers/VertexNormalsHelper.js"
            }
        }
    </script>
    <script type="module">
        import * as THREE from 'three'
        import { OrbitControls } from 'OrbitControls'
        import { GUI } from 'GUI'
        import { OBJLoader } from 'OBJLoader'
        import { MTLLoader } from 'MTLLoader'
        import { GLTFLoader } from 'GLTFLoader'
        import { VertexNormalsHelper } from 'VertexNormalsHelper'

        const scene = new THREE.Scene()
        const camera = new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 0.1, 1000)
        const TRAY = document.getElementById('js-tray-slide')
        const canvas = document.querySelector('#c')
        const clock = new THREE.Clock()
        const gui = new GUI()

        const renderer = new THREE.WebGLRenderer({ canvas, antialias: true })
        let autoE = false
        renderer.setSize(window.innerWidth, window.innerHeight)
        renderer.shadowMap.enabled = true
        renderer.setPixelRatio(window.devicePixelRatio)
        renderer.shadowMap.type = THREE.PCFSoftShadowMap
        document.body.appendChild(renderer.domElement)

        const controls = new OrbitControls(camera, renderer.domElement)
        function setCamera() {
            camera.position.set(3.663249037871437, 3.2943829468143138, 6.876483057858351)
            camera.rotation.set(-0.24904790882362943, 0.5073814726612403, 0.12295216578395465)
            controls.enableDamping = true
            controls.update()
        }
        setCamera()
        let loader = new GLTFLoader()

        let grid
        grid = new THREE.GridHelper(20, 40, 0x000000, 0x000000)
        grid.material.opacity = 0.2
        grid.material.depthWrite = false
        grid.material.transparent = true
        scene.add(grid)

        const vaz = await loader.loadAsync('./vaz/scene.gltf')
        const vaz2 = await loader.loadAsync('./vaz/scene.gltf')
        const vaz3 = await loader.loadAsync('./vaz/scene.gltf')
        const vaz4 = await loader.loadAsync('./vaz/scene.gltf')
        const vaz5 = await loader.loadAsync('./vaz/scene.gltf')
        const vaz6 = await loader.loadAsync('./vaz/scene.gltf')
        const vaz7 = await loader.loadAsync('./vaz/scene.gltf')
        let theModel = vaz.scene
        let matModel = vaz2.scene
        let gridModel = vaz3.scene
        let normalModel = vaz4.scene
        let wireModel = vaz5.scene
        let baseModel = vaz6.scene
        let metaModel = vaz7.scene
        scene.add(theModel)

        let helper
        theModel.traverse((o)=> {
            if(o.isMesh) {
                o.castShadow = true
                o.receiveShadow = true
            }
        })

        let ambientLight
        ambientLight = new THREE.AmbientLight(0xffffff, 0.95)
        scene.add(ambientLight)

        let hemiLight = new THREE.HemisphereLight(0xffffff,0xffffff,0.78)
        hemiLight.position.set(0,0,0)
        // scene.add(hemiLight)

        let pointLight = new THREE.PointLight()
        pointLight.position.set(0,2,0)
        pointLight.scale.set(0.05,0.05,0.05)
        pointLight.intensity = 2.5
        scene.add(pointLight)

        let dirLight = new THREE.DirectionalLight(0xffffff,0.54)
        dirLight.position.set(-8,12,8)
        dirLight.castShadow = true
        dirLight.shadow.mapSize = new THREE.Vector2(1024,1024)
        // scene.add(dirLight)

        let spotLight = new THREE.SpotLight(0xffffff, 0.15)
        scene.add(spotLight)
        spotLight.position.set(-7,10,3)


        const background_color = 0x928468
        scene.background = new THREE.Color(background_color)
        scene.fog = new THREE.Fog(background_color,20,100)

        const colors = [{color:'66533C'}, {color:'173A2F'}, {color:'153944'}, {color:'27548D'}, {color:'438AAC'}]
        function buildColors(colors) {
            for (let [i, color] of colors.entries()) {
                let swatch = document.createElement('div')
                swatch.classList.add('tray__swatch')
                swatch.style.background = "#" + color.color
                swatch.setAttribute('data-key', i)
                TRAY.append(swatch)
            }
        }
        buildColors(colors)

        // Swatches
        const swatches = document.querySelectorAll(".tray__swatch")
        for (const swatch of swatches) {
            swatch.addEventListener('click', selectSwatch)
        }

        let carBody = theModel.children[0].children[0].children[0].children[1].children[0].material.color
        // VAR 외부 color change event
        function selectSwatch(e) {
            let color = colors[parseInt(e.target.dataset.key)]
            let new_mtl
            new_mtl = new THREE.MeshPhongMaterial({
                color:parseInt('0x'+color.color),
                shininess: color.shininess ? color.shininess: 10
            })
            setMaterialColor(theModel,new_mtl)
        }
        function setMaterialColor(parent, mtl) {
            carBody.r = mtl.color.r
            carBody.g = mtl.color.g
            carBody.b = mtl.color.b
        }

        let props = {
            firstCamera: false,
            secondCamera: false,
            thirdCamera: false,
            fourthCamera: false,
        }

        const gltfFolder = gui.addFolder("camera")
        let moveCamera = gltfFolder.add(props,'firstCamera').name('firstMove').listen()
        moveCamera.onChange (
            function(e){
                if(e == true) {
                    props.secondCamera = false
                    props.thirdCamera = false
                    props.fourthCamera = false                         
                    firstLocation()
                } else {
                    setCamera()
                }
            }
        )
        let cuteCamera = gltfFolder.add(props,'secondCamera').name('cuteMove').listen()
        cuteCamera.onChange(
            function(e) {
                if(e == true) {
                    props.firstCamera = false
                    props.thirdCamera = false
                    props.fourthCamera = false
                    cuteLocation()
                } else {
                    setCamera()
                }
            }
        )
        let carDnCamera = gltfFolder.add(props,'thirdCamera').name('carDnMove').listen()
        carDnCamera.onChange(
            function(e) {
                if(e == true) {
                    props.firstCamera = false
                    props.secondCamera = false
                    props.fourthCamera = false
                    carDn()
                } else {
                    setCamera()
                }
            }
        )
        let carDnCamera2 = gltfFolder.add(props, 'fourthCamera').name('carDnMove2').listen()
        carDnCamera2.onChange(
            function(e) {
                if(e == true) {
                    props.firstCamera = false
                    props.secondCamera = false
                    props.thirdCamera = false
                    carDn2()
                } else {
                    setCamera()
                }
            }
        )
        // click & Camera move event
        function firstLocation() {
            gsap.to(camera.position,{
                duration: 1,
                x: -0.3084007032967616,
                y: 2.170361374179901,
                z: -1.5484965123508034
            })
            
            if(camera.rotation.x == '-3.034487'){
                gsap.to(camera.rotation, {
                    duration: 0.2,
                    y: -0.0679885531988692,
                })
            } else {
                gsap.to(camera.rotation, {
                    duration: 0.5,
                    x: -3.057089489107987,
                    y: -0.0679885531988692,
                    z: -3.1358381905682595,
                    delay: 0.6
                })
            }
        }
        function cuteLocation() {
            gsap.to(camera.position,{
                duration: 1,
                x: 0.049280145157820913,
                y: 1.8263274174864204,
                z: 0.22265007992236185
            })
            if(camera.rotation.x == '-3.057089' && camera.rotation.y == '-0.067989' && camera.rotation.z == '-3.135838') {
                gsap.to(camera.rotation, {
                    duration: 0.2,
                    y: 0.09798769704992441,
                })
            } else {
                gsap.to(camera.rotation, {
                    duration: 0.5,
                    x: -3.0344866460178874,
                    y: 0.09798769704992441,
                    z: 3.1310745046794355,
                    delay: 0.7
                })
            }
        }
        function carDn() {
            gsap.to(camera.position,{
                duration: 1,
                x: 2.459045966438709,
                y: -2.1421204839954684,
                z: 5.410323829811498
            })
            
            gsap.to(camera.rotation, {
                duration: 0.3,
                x: 0.8048158948029703,
                y: 0.5412204083012035,
                z: -0.4917114459662305,
                delay: 0.3
            })
        }
        function carDn2() {
            gsap.to(camera.position,{
                duration: 1,
                x: 1.3166716447391558,
                y: -1.877716388867218,
                z: -3.13906436539053
            })
            
            gsap.to(camera.rotation, {
                duration: 0.5,
                x: 2.105251008301363,
                y: 0.5339095515382513,
                z: -2.4314631483182185,
                delay: 0.4
            })
        }

        // VAR 외부 wireframe color change event
        const colorFolder = gui.addFolder('WIREFRAME')
        props.returnButton = function() {
            scene.traverse(function(child){
                if(child.isMesh) {
                    child.remove(child.children[0])
                }
            })
        }
        let whiteBtn = colorFolder.add(props, 'returnButton').name('Reset Wireframe')
        props.blackButton = function() {
            scene.traverse(function(child){
               if(child.isMesh) {
                    child.remove(child.children[0])
                    let wireframeGeometry = new THREE.WireframeGeometry(child.geometry)
                    let wireframeMaterial = new THREE.LineBasicMaterial({color:'#000000'})
                    let wireframe = new THREE.LineSegments(wireframeGeometry, wireframeMaterial)
                    child.add(wireframe)
               } 
            })
        }
        let blackBtn = colorFolder.add(props, 'blackButton').name('black Color')
        props.grayButton = function() {
            scene.traverse(function(child){
               if(child.isMesh) {
                    child.remove(child.children[0])
                    let wireframeGeometry = new THREE.WireframeGeometry(child.geometry)
                    let wireframeMaterial = new THREE.LineBasicMaterial({color:'#808080'})
                    let wireframe = new THREE.LineSegments(wireframeGeometry, wireframeMaterial)
                    child.add(wireframe)
               } 
            })
        }
        let grayBtn = colorFolder.add(props, 'grayButton').name('Gray Color')
        props.radButton = function() {
            scene.traverse(function(child){
               if(child.isMesh) {
                    child.remove(child.children[0])
                    let wireframeGeometry = new THREE.WireframeGeometry(child.geometry)
                    let wireframeMaterial = new THREE.LineBasicMaterial({color:'#FF0000'})
                    let wireframe = new THREE.LineSegments(wireframeGeometry, wireframeMaterial)
                    child.add(wireframe)
               } 
            })
        }
        let radBtn = colorFolder.add(props, 'radButton').name('Rad Color')
        props.blueButton = function() {
            scene.traverse(function(child){
               if(child.isMesh) {
                    child.remove(child.children[0])
                    let wireframeGeometry = new THREE.WireframeGeometry(child.geometry)
                    let wireframeMaterial = new THREE.LineBasicMaterial({color:'#000080'})
                    let wireframe = new THREE.LineSegments(wireframeGeometry, wireframeMaterial)
                    child.add(wireframe)
               } 
            })
        }
        let blueBtn = colorFolder.add(props, 'blueButton').name('Blue Color')
        props.greenButton = function() {
            scene.traverse(function(child){
               if(child.isMesh) {
                    child.remove(child.children[0])
                    let wireframeGeometry = new THREE.WireframeGeometry(child.geometry)
                    let wireframeMaterial = new THREE.LineBasicMaterial({color:'#00FF00'})
                    let wireframe = new THREE.LineSegments(wireframeGeometry, wireframeMaterial)
                    child.add(wireframe)
               } 
            })
        }
        let greenBtn = colorFolder.add(props, 'greenButton').name('Green Color')
        props.yellowButton = function() {
            scene.traverse(function(child){
               if(child.isMesh) {
                    child.remove(child.children[0])
                    let wireframeGeometry = new THREE.WireframeGeometry(child.geometry)
                    let wireframeMaterial = new THREE.LineBasicMaterial({color:'#FFFF00'})
                    let wireframe = new THREE.LineSegments(wireframeGeometry, wireframeMaterial)
                    child.add(wireframe)
               } 
            })
        }
        let yellowBtn = colorFolder.add(props, 'yellowButton').name('Yellow Color')

        theModel.traverse(function(child) {
            if(child.isMesh) {
                if(child.material.name == 'headlight1' || child.material.name == 'headlight2') {
                    child.material.opacity = .7         // opactiy
                    child.material.metalness = .75      // metalness
                    // child.material.roughness = .8    // roughness
                }
                if(child.material.name == 'signs') {
                    child.material.metalness = .6
                    child.material.specularIntensity = 1
                }
                if(child.material.name == 'lights') {
                    child.material.metalness = .88
                }
            }
        })

        // final VAR Model
        const renderFolder = gui.addFolder('RENDER')
        props.finalButton = function() {
            sceneReset()
            baseMaterial()
            scene.add(pointLight)
            theModel.traverse(function(child) {
                if(child.isMesh) {
                    if(child.material.name == 'headlight1') {
                        child.material.opacity = .7         // opactiy
                        child.material.metalness = .75      // metalness
                    }
                    if(child.material.name == 'signs') {
                        child.material.metalness = .6
                        child.material.specularIntensity = 1
                    }
                    if(child.material.name == 'lights') {
                        child.material.metalness = .9
                    }
                }
            })
        }
        let final = renderFolder.add(props, 'finalButton').name('Final Render')
        
        const modelFolder = gui.addFolder("Model Inspector")
        // Basic color
        props.baseButton = function() {
            baseMaterial()
            if(scene.name == 'mat' || scene.name == 'grid' || scene.name == 'normal' || scene.name == 'wire' || scene.name == '' || scene.name == 'meta') {
                scene.remove(matModel)
                scene.remove(gridModel)
                scene.remove(normalModel)
                scene.remove(wireModel)
                scene.remove(theModel)
                scene.remove(metaModel)
                scene.add(baseModel)
                scene.name = 'base'
            }
            scene.add(hemiLight)
            scene.add(dirLight)
            scene.remove(ambientLight)
            scene.add(pointLight)

            baseModel.traverse(function(child) {
                if(child.isMesh) {
                    // carcass
                    if(child.material.name == 'carcass') {
                        const carcassMap = new THREE.TextureLoader().load('./vaz/textures/carcass_baseColor.png')
                        child.material.map = carcassMap
                    }
                    // carcass2
                    if(child.material.name == 'carcass2') {
                        const carcassMap2 = new THREE.TextureLoader().load('./vaz/textures/carcass2_baseColor.png')
                        child.material.map = carcassMap2
                    }
                    // chairs
                    if(child.material.name == 'chairs') {
                        const chairsMap = new THREE.TextureLoader().load('./vaz/textures/chairs_baseColor.png')
                        child.material.map = chairsMap
                    }
                    // doorcards
                    if(child.material.name == 'doorcards') {
                        const doorcardsMap = new THREE.TextureLoader().load('./vaz/textures/doorcards_baseColor.png')
                        child.material.map = doorcardsMap
                    }
                    // engine1
                    if(child.material.name == 'engine1') {
                        const engine1Map = new THREE.TextureLoader().load('./vaz/textures/engine1_baseColor.png')
                        child.material.map = engine1Map
                    }
                    // engine2
                    if(child.material.name == 'engine2') {
                        const engine2Map = new THREE.TextureLoader().load('./vaz/textures/engine2_baseColor.png')
                        child.material.map = engine2Map
                    }
                    // engine3
                    if(child.material.name == 'engine3') {
                        const engine3Map = new THREE.TextureLoader().load('./vaz/textures/engine3_baseColor.png')
                        child.material.map = engine3Map
                    }
                    // glass1
                    if(child.material.name == 'glass1') {
                        const glass1Map = new THREE.TextureLoader().load('./vaz/textures/glass1_baseColor.png')
                        child.material.map = glass1Map
                    }
                    // headlight1
                    if(child.material.name == 'headlight1') {
                        const headlight1Map = new THREE.TextureLoader().load('./vaz/textures/headlight1_baseColor.png')
                        child.material.map = headlight1Map
                    }
                    // headlight2
                    if(child.material.name == 'headlight2') {
                        const headlight2Map = new THREE.TextureLoader().load('./vaz/textures/headlight2_baseColor.png')
                        child.material.map = headlight2Map
                    }
                    // lights
                    if(child.material.name == 'lights') {
                        const lightsMap = new THREE.TextureLoader().load('./vaz/textures/lights_baseColor.png')
                        child.material.map = lightsMap
                    }
                    // Material
                    if(child.material.name == 'Material') {
                        const MaterialMap = new THREE.TextureLoader().load('./vaz/textures/Material_baseColor.png')
                        child.material.map = MaterialMap
                    }
                    // Material.001
                    if(child.material.name == 'Material.001') {
                        const MaterialMap1 = new THREE.TextureLoader().load('./vaz/textures/Material.001_baseColor.png')
                        child.material.map = MaterialMap1
                    }
                    // plastic1
                    if(child.material.name == 'plastic1') {
                        const plastic1Map = new THREE.TextureLoader().load('./vaz/textures/plastic1_baseColor.png')
                        child.material.map = plastic1Map
                    }
                    // plastic2
                    if(child.material.name == 'plastic2') {
                        const plastic2Map = new THREE.TextureLoader().load('./vaz/textures/plastic2_baseColor.png')
                        child.material.map = plastic2Map
                    }
                    // rearlight1
                    if(child.material.name == 'rearlight1') {
                        const rearlight1Map = new THREE.TextureLoader().load('./vaz/textures/rearlight1_baseColor.png')
                        child.material.map = rearlight1Map
                    }
                    // rearlight2
                    if(child.material.name == 'rearlight2') {
                        const rearlight2Map = new THREE.TextureLoader().load('./vaz/textures/rearlight2_baseColor.png')
                        child.material.map = rearlight2Map
                    }
                    // salon1
                    if(child.material.name == 'salon1') {
                        const salon1Map = new THREE.TextureLoader().load('./vaz/textures/salon1_baseColor.png')
                        child.material.map = salon1Map
                    }
                    // salon2
                    if(child.material.name == 'salon2') {
                        const salon2Map = new THREE.TextureLoader().load('./vaz/textures/salon2_baseColor.png')
                        child.material.map = salon2Map
                    }
                    // salon3
                    if(child.material.name == 'salon3') {
                        const salon3Map = new THREE.TextureLoader().load('./vaz/textures/salon3_baseColor.png')
                        child.material.map = salon3Map
                    }
                    // salon4
                    if(child.material.name == 'salon4') {
                        const salon4Map = new THREE.TextureLoader().load('./vaz/textures/salon4_baseColor.png')
                        child.material.map = salon4Map
                    }
                    // salon5
                    if(child.material.name == 'salon5') {
                        const salon5Map = new THREE.TextureLoader().load('./vaz/textures/salon5_baseColor.png')
                        child.material.map = salon5Map
                    }
                    // salon6
                    if(child.material.name == 'salon6') {
                        const salon6Map = new THREE.TextureLoader().load('./vaz/textures/salon6_baseColor.png')
                        child.material.map = salon6Map
                    }
                    // seals
                    if(child.material.name == 'seals') {
                        const sealsMap = new THREE.TextureLoader().load('./vaz/textures/seals_baseColor.png')
                        child.material.map = sealsMap
                    }
                    // signs
                    if(child.material.name == 'signs') {
                        const signsMap = new THREE.TextureLoader().load('./vaz/textures/signs_baseColor.png')
                        child.material.map = signsMap
                    }
                    // stuff
                    if(child.material.name == 'stuff') {
                        const stuffMap = new THREE.TextureLoader().load('./vaz/textures/stuff_baseColor.png')
                        child.material.map = stuffMap
                    }
                    // suspension1
                    if(child.material.name == 'suspension1') {
                        const suspension1Map = new THREE.TextureLoader().load('./vaz/textures/suspension1_baseColor.png')
                        child.material.map = suspension1Map
                    }
                    // suspension2
                    if(child.material.name == 'suspension2') {
                        const suspension2Map = new THREE.TextureLoader().load('./vaz/textures/suspension2_baseColor.png')
                        child.material.map = suspension2Map
                    }
                    // under
                    if(child.material.name == 'under') {
                        const underMap = new THREE.TextureLoader().load('./vaz/textures/under_baseColor.png')
                        child.material.map = underMap
                    }
                    // wheels
                    if(child.material.name == 'wheels') {
                        const wheelsMap = new THREE.TextureLoader().load('./vaz/textures/wheels_baseColor.png')
                        child.material.map = wheelsMap
                    }
                    // wires
                    if(child.material.name == 'wires') {
                        const wiresMap = new THREE.TextureLoader().load('./vaz/textures/wires_baseColor.png')
                        child.material.map = wiresMap
                    }
                }
            })
        }
        let baseBtn = modelFolder.add(props, 'baseButton').name('Base Color')

        // 금속성 metalness
        props.metalnessButton = function() {
            if(scene.name == 'mat' || scene.name == 'grid' || scene.name == 'normal' || scene.name == 'wire' || scene.name == 'base' || scene.name == ''){
                scene.remove(matModel)
                scene.remove(gridModel)
                scene.remove(normalModel)
                scene.remove(wireModel)
                scene.remove(baseModel)
                scene.remove(theModel)
                scene.add(metaModel)
                scene.name = 'meta'
            }
            scene.add(hemiLight)
            scene.add(dirLight)
            scene.remove(ambientLight)

            metaModel.traverse(function(child) {
                if(child.isMesh) {
                    child.material.opacity = .2                 // opacity
                    child.material.roughness = .5               // roughness

                    if(child.material.name == 'lights') {       // headlight
                        child.material.metalness = .5
                    }
                    if(child.material.name == 'carcass') {      // car body
                        child.material.color.set(1,1,1)
                        child.material.opacity = 1
                        child.material.metalness = 0              
                    }
                    if(child.material.name == 'stuff') {        // headlight 점
                        child.material.color.set(1,1,1)
                    }
                    if(child.material.name == 'seals') {        // A 필터
                    }
                    if(child.material.name == 'plastic1') {     // 얼룩
                        child.material.opacity = 10
                    }
                    if(child.material.name == 'signs') {        // logo
                        child.material.color.set(255,255,255)
                        child.material.color.r = 255
                        child.material.color.g = 255
                        child.material.color.b = 255
                    }
                }
            })
            scene.add(pointLight)
            scene.traverse(function(child){
                if(child.isLine) {
                    child.visible = false
                }
            })
        }
        let metalnessBtn = modelFolder.add(props,'metalnessButton').name('Metalness')

        // 거칠기 roughness
        props.roughnessButton = function() {
            sceneReset()
            scene.add(pointLight)
            theModel.traverse(function(child) {
                if(child.isMesh) {
                    child.material.opacity = .2          // opacity
                    child.material.metalness = .5        // metalness
                    child.material.roughness = 10        // roughness
                }
            })
            scene.traverse(function(child){
                if(child.isLine) {
                    child.visible = false
                }
            })
        }
        let roughnessBtn = modelFolder.add(props,'roughnessButton').name('Roughness')

        // 노멀 맵 Normal Map
        props.normalButton = function() {
            sceneReset()
            if(scene.name == 'mat' || scene.name == 'grid' || scene.name == '' || scene.name == 'wire' || scene.name == 'base' || scene.name == 'meta') {
                scene.remove(matModel)
                scene.remove(gridModel)
                scene.remove(theModel)
                scene.remove(wireModel)
                scene.remove(baseModel)
                scene.remove(metaModel)
                scene.add(normalModel)
                scene.name = 'normal'
            }
            scene.remove(pointLight)

            scene.traverse(function(child){
                if(child.isLine) {
                    child.visible = false
                }
            })
            let carBody2 = normalModel.children[0].children[0].children[0].children[1].children[0].material.color
            normalModel.traverse(function(child) {
                carBody2.r = 0
                carBody2.g = 0
                carBody2.b = 0
                if(child.isMesh) {
                    if(child.material.name == 'carcass2') {
                        child.material.color.r = 0
                        child.material.color.g = 0
                        child.material.color.b = 0
                    }
                    // chairs
                    if(child.material.name == 'chairs') {
                        const chairsMap = new THREE.TextureLoader().load('./vaz/textures/chairs_normal.png')
                        child.material.map = chairsMap
                    }
                    // doorcards
                    if(child.material.name == 'doorcards') {
                        const doorcardsMap = new THREE.TextureLoader().load('./vaz/textures/doorcards_normal.png')
                        child.material.map = doorcardsMap
                    }
                    // engine1
                    if(child.material.name == 'engine1') {
                        const engineMap1 = new THREE.TextureLoader().load('./vaz/textures/engine1_normal.png')
                        child.material.map = engineMap1
                    }
                    // engine2
                    if(child.material.name == 'engine2') {
                        const engineMap2 = new THREE.TextureLoader().load('./vaz/textures/engine2_normal.png')
                        child.material.map = engineMap2
                    }
                    // engine3
                    if(child.material.name == 'engine3') {
                        const engineMap3 = new THREE.TextureLoader().load('./vaz/textures/engine3_normal.png')
                        child.material.map = engineMap3
                    }
                    // lights
                    if(child.material.name == 'lights') {
                        const lightsMap = new THREE.TextureLoader().load('./vaz/textures/lights_normal.png')
                        child.material.map = lightsMap
                    }
                    // salon1
                    if(child.material.name == 'salon1') {
                        const salonMap1 = new THREE.TextureLoader().load('./vaz/textures/salon1_normal.png')
                        child.material.map = salonMap1
                    }
                    // salon3
                    if(child.material.name == 'salon3') {
                        const salonMap3 = new THREE.TextureLoader().load('./vaz/textures/salon3_normal.png')
                        child.material.map = salonMap3
                    }
                    // salon4
                    if(child.material.name == 'salon4') {
                        const salonMap4 = new THREE.TextureLoader().load('./vaz/textures/salon4_normal.png')
                        child.material.map = salonMap4
                    }
                    // salon5
                    if(child.material.name == 'salon5') {
                        const salonMap5 = new THREE.TextureLoader().load('./vaz/textures/salon5_normal.png')
                        child.material.map = salonMap5
                    }
                    // salon6
                    if(child.material.name == 'salon6') {
                        const salonMap6 = new THREE.TextureLoader().load('./vaz/textures/salon6_normal.png')
                        child.material.map = salonMap6
                    }
                    // stuff
                    if(child.material.name == 'stuff') {
                        const stuffMap = new THREE.TextureLoader().load('./vaz/textures/stuff_normal.png')
                        child.material.map = stuffMap
                    }   
                    // tubes
                    if(child.material.name == 'tubes') {
                        const tubes = new THREE.TextureLoader().load('./vaz/textures/tubes_normal.png')
                        child.material.map = tubes
                    }
                    // wheels
                    if(child.material.name == 'wheels') {
                        const wheelsMap = new THREE.TextureLoader().load('./vaz/textures/wheels_normal.png')
                        child.material.map = wheelsMap
                    }
                }
            })
        }
        let normalBtn = modelFolder.add(props,'normalButton').name('Normal Map')

        // 불투명 opacity
        props.opacityButton = function() {
            sceneReset()
            theModel.traverse(function(child) {
                if(child.isMesh) {
                    child.material.opacity = .7         // opactiy
                    child.material.metalness = 1        // metalness
                    child.material.roughness = 1        // roughness
                }
            })
            scene.add(pointLight)
            scene.traverse(function(child){
                if(child.isLine) {
                    child.visible = false
                }
            })
        }
        let opacityBtn = modelFolder.add(props,'opacityButton').name('Opacity')

        // 빛 x Emission 
        props.emissionButton = function() {
            if(scene.name == 'mat' || scene.name == 'grid' || scene.name == 'normal' || scene.name == 'wire' || scene.name == 'base' || scene.name == 'meta') {
                scene.remove(matModel)
                scene.remove(gridModel)
                scene.remove(normalModel)
                scene.remove(wireModel)
                scene.remove(baseModel)
                scene.remove(metaModel)
                scene.add(theModel)
                scene.name = ''
            }
            scene.add(pointLight)
            baseMaterial()
            scene.remove(hemiLight)
            scene.remove(dirLight)
            scene.remove(pointLight)
            scene.remove(ambientLight)
            scene.traverse(function(child){
                if(child.isLine) {
                    child.visible = false
                }
            })
        }
        let emissionBtn = modelFolder.add(props, 'emissionButton').name('Emission')

        // 반사광 Specular F0
        props.specularButton = function() {
            sceneReset()
            baseMaterial()
            scene.add(pointLight)
            theModel.traverse(function(child) {
                if(child.isMesh) {
                    child.material.specularIntensity = .01
                }
            })
        }
        let specularBtn = modelFolder.add(props, 'specularButton').name('Specular F0')

        const geometryFolder = gui.addFolder("geometry")
        // matcap
        props.matcapButton = function() {
            if(scene.name == '' || scene.name == 'grid' || scene.name == 'normal' || scene.name == 'wire' || scene.name == 'base' || scene.name == 'meta'){
                scene.remove(theModel)
                scene.remove(gridModel)
                scene.remove(normalModel)
                scene.remove(wireModel)
                scene.remove(baseModel)
                scene.remove(metaModel)
                scene.add(matModel)
                scene.name = 'mat'
            }
            scene.remove(pointLight)
            scene.add(hemiLight)
            scene.add(dirLight)
            scene.remove(ambientLight)

            const matcapTexture = new THREE.TextureLoader().load('./vaz/Meta_color.jpg')
            matModel.traverse(function(child) {
                if(child.isMesh) {
                    child.material.opacity = .2         // opacity
                    child.material.metalness = 1        // metalness
                    child.material.roughness = 1        // roughness
                    child.material.map = matcapTexture
                }
            })
            scene.traverse(function(child) {
                if(child.isLine) {
                    child.visible = false
                }
            })
        }
        let matcapBtn = geometryFolder.add(props, 'matcapButton').name('Matcap')

        // wireframe
        props.wireframeButton = function() {
            if(scene.name == 'mat' || scene.name == 'grid' || scene.name == 'normal' || scene.name == '' || scene.name == 'base' || scene.name == 'meta') {
                scene.remove(matModel)
                scene.remove(gridModel)
                scene.remove(normalModel)
                scene.remove(theModel)
                scene.remove(baseModel)
                scene.remove(metaModel)
                scene.add(wireModel)
                scene.name = 'wire'
            }
            scene.add(pointLight)
            scene.add(hemiLight)
            scene.add(dirLight)
            scene.remove(ambientLight)
            
            scene.traverse(function(child) {
                if(child.isLine) {
                    child.visible = false
                }
            })
            wireModel.traverse(function(child) {
                if(child.isMesh) {
                    child.material.opacity = .2         // opacity
                    child.material.metalness = 1        // metalness
                    child.material.roughness = 1        // roughness

                    let wireframeGeometry = new THREE.WireframeGeometry(child.geometry)
                    let wireframeMaterial = new THREE.LineBasicMaterial({color:0xffffff})
                    let wireframe = new THREE.LineSegments(wireframeGeometry, wireframeMaterial)
                    child.add(wireframe)

                    if(child.material.name != 'glass1') {
                        let matcapMaterial = new THREE.MeshMatcapMaterial()
                        child.material = matcapMaterial
                    }
                }
            })
        }
        let wireframeBtn = geometryFolder.add(props,'wireframeButton').name('Wireframe')

        // Vertex Normals
        props.vertexButton = function() {
            sceneReset()
            scene.add(pointLight)
            theModel.traverse(function(child) {
                if(child.isMesh) {
                    helper = new VertexNormalsHelper(child, 0.06, 0xff0000 )
                    scene.add(helper)
                }
            })
        }
        let vertexBtn = geometryFolder.add(props,'vertexButton').name('Vertex Normals')

        // uv checker
        const uvFolder = gui.addFolder('UV')
        props.uvButton = function() {
            baseMaterial()
            if(scene.name == 'mat' || scene.name == '' || scene.name == 'normal' || scene.name == 'wire' || scene.name == 'base' || scene.name == 'meta'){
                scene.traverse(function(child){
                    if(child.isLine) {
                        child.visible = false
                    }
                })
                scene.remove(matModel)
                scene.remove(theModel)
                scene.remove(normalModel)
                scene.remove(wireModel)
                scene.remove(baseModel)
                scene.remove(metaModel)
                scene.add(gridModel)
                scene.name = 'grid'
            }
            scene.remove(pointLight)
            const gridTexture = new THREE.TextureLoader().load('./vaz/uv_grid_opengl.jpg')
            gridModel.traverse(function(child) {
                if(child.isMesh) {
                    child.material.map = gridTexture
                }
            })
        }
        let uvBtn = uvFolder.add(props, 'uvButton').name('UV Checker')

        function baseMaterial() {
            theModel.traverse(function(child) {
                if(child.isMesh) {
                    child.material.opacity = .2         // opactiy
                    child.material.metalness = 1        // metalness
                    child.material.roughness = 1        // roughness
                }
            })
            scene.traverse(function(child){
                if(child.isLine) {
                    child.visible = false
                }
            })
        }
        
        function sceneReset() {
            if(scene.name == 'mat' || scene.name == 'grid' || scene.name == 'normal' || scene.name == 'wire' || scene.name == 'base' || scene.name == 'meta'){
                scene.remove(matModel)
                scene.remove(gridModel)
                scene.remove(normalModel)
                scene.remove(wireModel)
                scene.remove(baseModel)
                scene.remove(metaModel)
                scene.add(theModel)
                scene.name = ''
            }
            scene.add(hemiLight)
            scene.add(dirLight)
            scene.remove(ambientLight)
        }

        function animate() {
            requestAnimationFrame(animate)
            theModel.traverse(function(child) {
                if(child.isMesh) {
                    if(child.material.name == 'wheels'){
                        child.rotation.x += .05
                    }
                }
            })
            const time = -performance.now() / 1000
            grid.position.z = (time) % 1
            renderer.render(scene, camera)
        }        
        animate()

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight
            camera.updateProjectionMatrix()
            renderer.setSize(window.innerWidth, window.innerHeight)
        }
        window.addEventListener('resize', onWindowResize)
    </script>
    <canvas id="c"></canvas>
    <div class="controls">
        <div id="js-tray" class="tray">
            <div id="js-tray-slide" class="tray__slide"></div>
        </div>
    </div>
</body>
</html>